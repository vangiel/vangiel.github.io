---
import RepublicIcon from '@/icons/republic.astro';
import RebelIcon from '@/icons/rebel.astro';
import { DARK_THEME, LIGHT_THEME } from '@/consts/themes'; 
---

<button id="themeToggle">
	<RepublicIcon class="light-icon" />
  <RebelIcon class="dark-icon" />
  <span class="visually-hidden"></span>
</button>
  
<style>
  #themeToggle {
    width: 4rem;
    aspect-ratio: 1;
  }

  :global(.dark-icon){ 
    display: none; 
    color: var(--clr-text);
  }

  :global(.light-icon){
    color: var(--clr-text);
  }

  :global([data-theme="🌑"] .light-icon ){
     display: none; 
  }

  :global([data-theme="🌑"] .dark-icon ){
     display: inline; 
  }

</style>

<script is:inline define:vars={{ darkTheme: DARK_THEME, lightTheme: LIGHT_THEME }}>
  function handleToggleClick() {
    const element = document.documentElement;

    element.getAttribute("data-theme") === "☀️"
     ? element.setAttribute("data-theme", "🌑")
      : element.setAttribute("data-theme", "☀️");

    const isDark = element.getAttribute("data-theme") === "🌑";
    localStorage.setItem("theme", isDark ? darkTheme : lightTheme);

    const theme = getTheme();
    updateThemeMessage(theme);
  }

	function getTheme() {
    if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
      return localStorage.getItem('theme');
    }
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return darkTheme;
    }
      return lightTheme;
  }

  function updateThemeMessage(theme) {
		const translation = (theme === darkTheme) ? "dark" : "light";
		const actualThemeMsg = `Toggle theme, the current theme is ${translation}`;
		const span = document.querySelector("span.visually-hidden");
		span.innerHTML = actualThemeMsg;
	}

  const theme = getTheme();
  updateThemeMessage(theme);

  if (theme === lightTheme) {
    document.documentElement.setAttribute("data-theme", "☀️");
  } else {
    document.documentElement.setAttribute("data-theme", "🌑");
  }

  window.localStorage.setItem('theme', theme);
  document.getElementById("themeToggle").addEventListener("click", handleToggleClick);
</script>